<% layout("/layout/seller_dashboard_layout") %>

<h3 class="mb-4">ðŸ“¦ Customer Orders</h3>

<% if (orders.length === 0) { %>
  <p class="text-muted">No orders found.</p>
<% } else { %>

<!-- Responsive wrapper -->
<div class="table-responsive-lg">

  <table class="table table-bordered align-middle text-center mb-0">
    <thead class="table-dark">
      <tr>
        <th>Order ID</th>
        <th>Products</th>
        <th>Total</th>

        <!-- Hide on small screens -->
        <th class="d-none d-md-table-cell">Payment</th>
        <th>Status</th>
        <th class="d-none d-lg-table-cell">Order Date</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <% orders.forEach(order => { %>
        <% let total = 0; %>

        <% order.items.forEach(item => { %>
          <% if (item.productId) { %>
            <% total += item.quantity * item.productId.current_price; %>
          <% } %>
        <% }) %>

        <tr>
          <!-- Order ID -->
          <td class="fw-bold small">
            <%= order.orderId %>
          </td>

          <!-- Products -->
          <td>
            <div class="d-flex flex-wrap justify-content-center gap-1">
              <% order.items.forEach(item => { %>
                <% if (item.productId) { %>
                  <img src="<%= item.productId.image %>"
                       width="40"
                       height="40"
                       class="rounded"
                       title="<%= item.productId.item_name %>">
                <% } else { %>
                  <span class="badge bg-danger">Removed</span>
                <% } %>
              <% }) %>
            </div>
          </td>

          <!-- Total -->
          <td class="fw-bold text-success">
            â‚¹ <%= total %>
          </td>

          <!-- Payment (tablet & up) -->
          <td class="d-none d-md-table-cell">
            <%= order.paymentMethod %>
          </td>

          <!-- Status -->
          <td>
            <span class="badge px-3 py-2
              <%= order.status === 'Delivered' ? 'bg-success' :
                  order.status === 'Cancelled' ? 'bg-danger' :
                  order.status === 'Confirmed' ? 'bg-primary' :
                  'bg-warning text-dark' %>">
              <%= order.status %>
            </span>
          </td>

          <!-- Date (desktop only) -->
          <td class="d-none d-lg-table-cell small">
            <%= order.orderDate.toDateString() %>
          </td>

          <!-- Action -->
          <td>
            <a href="/seller/orders/<%= order._id %>"
               class="btn btn-sm btn-outline-primary w-100">
              View
            </a>
          </td>
        </tr>
      <% }) %>
    </tbody>

  </table>
</div>

<% } %>