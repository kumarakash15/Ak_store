<% layout("/layout/seller_dashboard_layout") %>
<!-- Back Button -->
<a href="/seller/orders" class="btn btn-outline-secondary mb-3 w-md-auto">
  ‚¨Ö Back to Orders
</a>
<div class="card shadow rounded-4">
  <!-- HEADER -->
  <div class="card-header d-flex flex-column flex-md-row
              justify-content-between align-items-start align-items-md-center gap-2">
    <div>
      <div class="fw-bold">Order ID: <%= order.orderId %></div>
      <small class="text-muted">
        Placed on: <%= order.orderDate.toDateString() %>
      </small>
    </div>
    <span class="badge px-3 py-2 fs-6
      <%= order.status === 'Delivered' ? 'bg-success' :
          order.status === 'Cancelled' ? 'bg-danger' :
          order.status === 'Confirmed' ? 'bg-primary' :
          order.status === 'Shipped' ? 'bg-info' :
          'bg-warning text-dark' %>">
      <%= order.status %>
    </span>
  </div>
  <!-- BODY -->
  <div class="card-body">
    <!-- STATUS ACTIONS -->
    <% if (order.status !== "Cancelled" && order.status !== "Delivered") { %>
      <div class="mb-4 d-flex flex-column flex-sm-row gap-2">
        <% if (order.status === "Pending") { %>
          <form action="/seller/orders/<%= order._id %>/status" method="POST" class="w-100">
            <input type="hidden" name="status" value="Confirmed">
            <button class="btn btn-primary">‚úÖ Confirm Order</button>
          </form>
        <% } %>
        <% if (order.status === "Confirmed") { %>
          <form action="/seller/orders/<%= order._id %>/status" method="POST" class="w-100">
            <input type="hidden" name="status" value="Shipped">
            <button class="btn btn-warning">üöö Mark as Shipped</button>
          </form>
        <% } %>
        <% if (order.status === "Shipped") { %>
          <form action="/seller/orders/<%= order._id %>/status" method="POST" class="w-100">
            <input type="hidden" name="status" value="Delivered">
            <button class="btn btn-success">üì¶ Mark as Delivered</button>
          </form>
        <% } %>
      </div>
      <hr>
    <% } %>
    <!-- CUSTOMER + ADDRESS -->
    <div class="row g-3 mb-4">
      <div class="col-12 col-md-6">
        <div class="border rounded p-3 h-100">
          <h6 class="mb-2">üë§ Customer Details</h6>
          <p class="mb-0">
            <strong>Name:</strong> <%= order.name %><br>
            <strong>Mobile:</strong> <%= order.mobile %><br>
            <strong>Payment:</strong> <%= order.paymentMethod %>
          </p>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="border rounded p-3 h-100">
          <h6 class="mb-2">üè† Delivery Address</h6>
          <p class="mb-0">
            <%= order.house %>, <%= order.locality %><br>
            <%= order.city %>, <%= order.state %> - <%= order.pincode %>
          </p>
        </div>
      </div>
    </div>
    <!-- ITEMS -->
    <h6 class="mb-3">üõí Ordered Items</h6>
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead class="table-light">
          <tr>
            <th>Image</th>
            <th>Product</th>
            <th class="d-none d-md-table-cell">Company</th>
            <th>Qty</th>
            <th>Price</th>
          </tr>
        </thead>
        <tbody>
          <% let total = 0; %>
          <% order.items.forEach(item => { %>
            <% if (item.productId) { %>
              <% total += item.quantity * item.productId.current_price; %>
              <tr>
                <td>
                  <img src="<%= item.productId.image %>" width="50" class="rounded">
                </td>
                <td><%= item.productId.item_name %></td>
                <td class="d-none d-md-table-cell"><%= item.productId.company %></td>
                <td><%= item.quantity %></td>
                <td>‚Çπ <%= item.productId.current_price %></td>
              </tr>
            <% } else { %>
              <tr>
                <td colspan="5" class="text-danger text-center">
                  ‚ùå Product Removed From Store
                </td>
              </tr>
            <% } %>
          <% }) %>
        </tbody>
      </table>
    </div>
    <!-- TOTAL -->
    <div class="text-end fw-bold fs-5 mt-2">
      Total Amount: ‚Çπ <%= total %>
    </div>
    <!-- TIMELINE -->
    <hr>
    <h6>‚è± Order Timeline</h6>
    <ul class="small text-muted mb-0">
      <li>Order Placed: <%= order.orderDate.toLocaleString() %></li>
      <% if (order.confirmedAt) { %>
        <li>Confirmed: <%= order.confirmedAt.toLocaleString() %></li>
      <% } %>
      <% if (order.shippedAt) { %>
        <li>Shipped: <%= order.shippedAt.toLocaleString() %></li>
      <% } %>
      <% if (order.deliveredAt) { %>
        <li>Delivered: <%= order.deliveredAt.toLocaleString() %></li>
      <% } %>
    </ul>
  </div>
</div>