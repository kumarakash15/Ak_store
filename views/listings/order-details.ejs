<% layout("/layout/bollerplate") %>

<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <!-- âœ… Order Header -->
      <div class="card shadow-sm mb-4 p-4 border-0 rounded-4 bg-light">
        <div class="d-flex align-items-center">
          <div class="me-3" style="font-size:40px;color:#f57224;">âœ…</div>
          <div>
            <h3 class="mb-1">Order Confirmed!</h3>
            <p class="text-muted mb-0">Thank you for shopping with <strong>AkStore</strong></p>
          </div>
        </div>
      </div>

      <!-- ðŸ›’ Order Details -->
      <div class="card shadow-sm mb-4 p-4 border-0 rounded-4">
        <h4 class="mb-3">Order Details</h4>
        <p><strong>Order ID:</strong> <%= order._id || "N/A" %></p>
        <p><strong>Order Date:</strong> <%= order.orderDate ? order.orderDate.toDateString() : "N/A" %></p>
        <p><strong>Status:</strong> 
          <span class="badge bg-<%= order.status === 'Pending' ? 'warning' : order.status === 'Confirmed' ? 'info' : order.status === 'Shipped' ? 'primary' : 'success' %>">
            <%= order.status || "Pending" %>
          </span>
        </p>
      </div>

      <!-- ðŸ“¦ Products List -->
      <div class="card shadow-sm mb-4 p-4 border-0 rounded-4">
        <h4 class="mb-3">Products</h4>
        <% let totalAmount = 0; %>
        <% order.items.forEach(item => { %>
          <% if (item.productId) { %>
            <% 
              const product = item.productId;
              const itemTotal = product.current_price * item.quantity;
              totalAmount += itemTotal;
            %>
            <div class="d-flex mb-3 align-items-center p-3 border rounded-3 bg-white">
              <img src="<%= product.image || '/placeholder.png' %>" alt="product" class="product-img">
              <div class="ms-3 flex-grow-1">
                <h5 class="mb-1"><%= product.item_name || "Unnamed Product" %></h5>
                <p class="text-muted mb-1"><%= product.company || "Unknown Company" %></p>
                <p class="mb-0">Qty: <%= item.quantity %> | <strong>â‚¹ <%= itemTotal %></strong></p>
              </div>
            </div>
          <% } %>
        <% }) %>
        <hr>
        <h5 class="text-end">Total Amount(COD): â‚¹ <%= totalAmount %></h5>
      </div>

      <!-- ðŸ  Delivery Address -->
      <div class="card shadow-sm mb-4 p-4 border-0 rounded-4">
        <h4 class="mb-3">Delivery Address</h4>
        <p><strong><%= order.name || "N/A" %></strong></p>
        <p class="mb-1"><%= order.house || "" %>, <%= order.locality || "" %></p>
        <p class="mb-1"><%= order.city || "" %> - <%= order.pincode || "" %>, <%= order.state || "" %></p>
        <p><strong>Mobile:</strong> <%= order.mobile || "N/A" %></p>
      </div>

      <!-- ðŸ“ Order Tracking -->
      <div class="card shadow-sm mb-4 p-4 border-0 rounded-4">
        <h4 class="mb-3">Order Tracking</h4>

        <div class="progress-step-container d-flex justify-content-between position-relative mb-3">
          <div class="step <%= ['Pending','Confirmed','Shipped','Delivered'].includes(order.status) ? 'active' : '' %>">Order Placed</div>
          <div class="step <%= ['Confirmed','Shipped','Delivered'].includes(order.status) ? 'active' : '' %>">Confirmed</div>
          <div class="step <%= ['Shipped','Delivered'].includes(order.status) ? 'active' : '' %>">Shipped</div>
          <div class="step <%= order.status === 'Delivered' ? 'active' : '' %>">Delivered</div>
        </div>

        <div class="progress" style="height:6px; border-radius:3px;">
          <div class="progress-bar bg-success" role="progressbar" 
            style="width: <%= order.status === 'Pending' ? '25%' : order.status === 'Confirmed' ? '50%' : order.status === 'Shipped' ? '75%' : '100%' %>;">
          </div>
        </div>
      </div>

      <a href="/order" class="btn btn-primary w-100 rounded-4 py-2">Back to Orders</a>

    </div>
  </div>
</div>